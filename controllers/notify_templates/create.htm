<? Admin_Breadcrumb::add('Settings', 'admin/settings')->add('Notification Templates', 'notify/templates')->add($this->app_page_title);?>
<? Phpr_View::begin_block("view") ?>
	<?=flash()?>

	<? if (!isset($fatal_error)): ?>

		<?=form_open()?>

			<? $this->form_render() ?>

			<div id="fixed-toolbar" class="top">
				<div class="form-toolbar">
					<?=admin_ajax_button('Save', 'create_on_save', array('class'=>'btn-success'), "prepareFunction: function(){phprTriggerSave();}") ?>
					<?
						$user_email = $this->active_user->email;
						if (strlen($user_email))
							echo admin_ajax_button('Send test message', 'on_test', array('class'=>'btn-primary'), "confirm: 'Test message will be sent to your email address ".$user_email.". Continue?', loadIndicator: {hideOnSuccess: true}, hideErrorOnSuccess: false, update: 'form_flash', prepareFunction: function(){phprTriggerSave();}");
						else
							echo admin_ajax_button('Send test message', 'on_test', array('class'=>'btn-primary'), "alert: 'Your email address is not defined. Please specify it in the user parameters.'");
					?>
					<?=admin_ajax_button('Cancel', 'create_on_cancel') ?>
				</div>
			</div>

		<?=form_close()?>

	<? else: ?>
		<p><a href="<?= url('notify/templates') ?>">Return to the notification list</a></p>
	<? endif ?>
<? Phpr_View::end_block() ?>